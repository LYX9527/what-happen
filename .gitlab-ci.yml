variables:
  NAME: 'what-happen'
  VERSION: 'v1.0.0'
  IMAGE_NAME: ${NAME}:${VERSION}
stages:
  - master

master:
  stage: master
  only:
    - master
  tags:
    - online
  script:
    - echo "Node.js version:"
    - node -v # 验证版本
    - echo "npm version:"
    - npm -v  # 验证版本
    - rm -rf node_modules yarn.lock package-lock.json
    - npm ci
    - cp .env.example .env
    - npm run build
    - cd docker
    - docker build --no-cache -t ${IMAGE_NAME} .
    - docker-compose up -d
